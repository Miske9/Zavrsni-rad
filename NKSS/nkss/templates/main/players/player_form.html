{% extends 'main/base.html' %}
{% load form_tags %}

{% block title %}
  {% if form.instance.pk %}
    Uredi igraƒça
  {% else %}
    Dodaj igraƒça
  {% endif %}
{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="card shadow border-0">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0">
        {% if form.instance.pk %}
          ‚úèÔ∏è Uredi igraƒça
        {% else %}
          ‚ûï Dodaj igraƒça
        {% endif %}
      </h3>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3">
        {% csrf_token %}

        <!-- Osnovni podaci -->
        <div class="col-12">
          <h5 class="border-bottom pb-2 mb-3">üìù Osnovni podaci</h5>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.first_name.id_for_label }}">Ime:</label>
          {{ form.first_name|add_class:"form-control" }}
          {% if form.first_name.errors %}
            <div class="text-danger small">{{ form.first_name.errors|striptags }}</div>
          {% endif %}
        </div>
        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.last_name.id_for_label }}">Prezime:</label>
          {{ form.last_name|add_class:"form-control" }}
          {% if form.last_name.errors %}
            <div class="text-danger small">{{ form.last_name.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.date_of_birth.id_for_label }}">Datum roƒëenja:</label>
          {{ form.date_of_birth|add_class:"form-control" }}
          {% if form.date_of_birth.errors %}
            <div class="text-danger small">{{ form.date_of_birth.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.position.id_for_label }}">Pozicija:</label>
          {{ form.position|add_class:"form-select" }}
          {% if form.position.errors %}
            <div class="text-danger small">{{ form.position.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.category.id_for_label }}">Kategorija:</label>
          {{ form.category|add_class:"form-select" }}
          {% if form.category.errors %}
            <div class="text-danger small">{{ form.category.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- Podaci o ƒçlanstvu -->
        <div class="col-12">
          <h5 class="border-bottom pb-2 mb-3 mt-4">üèÉ ƒålanstvo u klubu</h5>
        </div>

        <div class="col-md-6">
          <div class="form-check mb-0 d-flex align-items-center">
            {{ form.is_active_member|add_class:"form-check-input me-2" }}
            <label class="form-check-label fw-semibold" for="{{ form.is_active_member.id_for_label }}">
              {{ form.is_active_member.label }}
            </label>
          </div>
          {% if form.is_active_member.errors %}
            <div class="text-danger small">{{ form.is_active_member.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.member_since.id_for_label }}">ƒålan od:</label>
          {{ form.member_since|add_class:"form-control" }}
          {% if form.member_since.errors %}
            <div class="text-danger small">{{ form.member_since.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold" for="{{ form.member_until.id_for_label }}">ƒålan do (opcionalno):</label>
          {{ form.member_until|add_class:"form-control" }}
          <div class="form-text">Ostavite prazno za aktivne ƒçlanove</div>
          {% if form.member_until.errors %}
            <div class="text-danger small">{{ form.member_until.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- Prika≈æi gre≈°ke forme -->
        {% if form.non_field_errors %}
          <div class="col-12">
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          </div>
        {% endif %}

        <div class="col-12 d-flex justify-content-end gap-2 mt-4">
          <a href="{% url 'main:player_list' %}" class="btn btn-outline-secondary">Odustani</a>
          <button class="btn btn-success" type="submit">üíæ Spremi</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// JavaScript za automatsko skrivanje/prikazivanje polja "ƒålan do" ovisno o statusu
document.addEventListener('DOMContentLoaded', function() {
    const isActiveCheckbox = document.getElementById('{{ form.is_active_member.id_for_label }}');
    const memberUntilField = document.getElementById('{{ form.member_until.id_for_label }}');
    const memberUntilContainer = memberUntilField.closest('.col-md-6');

    function toggleMemberUntil() {
        if (isActiveCheckbox.checked) {
            memberUntilContainer.style.display = 'none';
            memberUntilField.value = '';
        } else {
            memberUntilContainer.style.display = 'block';
        }
    }

    // Pozovi na poƒçetku
    toggleMemberUntil();

    // Dodaj event listener
    isActiveCheckbox.addEventListener('change', toggleMemberUntil);
});
</script>

{% endblock %}